<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.oracle.S202350102.JhChallengMapper">

	<!-- 후기 내용 -->
	<select id="jhReviewContent" parameterType="int" resultType="Board">
		SELECT  b.brd_num, b.title, b.conts, b.img, b.reg_date, u.user_num, u.nick, b.view_cnt, replyCount(b.brd_num) replyCount
		FROM 	board b
		INNER JOIN user1 u ON b.user_num = u.user_num
		WHERE 	b.brd_num = #{brd_num}
	</select>
	
	<!-- 후기 총 수 -->
	<select id="jhReviewTotal" parameterType="int" resultType="int">
		SELECT 	COUNT(*)
		FROM 	board b
		INNER JOIN challenge c ON b.chg_id = c.chg_id
		WHERE 	brd_lg = 700
		AND 	brd_md = 101
		AND 	c.chg_id = #{chg_id}
		AND 	brd_step = 0
	</select>
	
	<!-- 후기 리스트 -->
	<select id="jhChgReviewList" parameterType="Board" resultType="Board">
		SELECT * 
		FROM (
		        SELECT  ROWNUM AS rn, a.* 
		        FROM    (
		                    SELECT      b.brd_num , b.title, b.user_num, u.nick, b.view_cnt, b.reg_date, replyCount(b.brd_num) replyCount
		                    FROM 		board b
		                    INNER JOIN 	user1 u      ON b.user_num = u.user_num
		                    INNER JOIN 	challenge ch ON b.chg_id   = ch.chg_id
		                    WHERE 		ch.chg_id   = #{chg_id}
		                    AND 		brd_lg     	= 700
		                    AND 		brd_md    	= 101
		                    AND 		b.brd_step 	= 0
		                    ORDER BY 	b.brd_num DESC) a
		)
		WHERE rn BETWEEN #{start} AND #{end}  
	</select>
	
	<!-- 조회수 올리기 -->
	<update id="jhViewCntUp" parameterType="int">
		UPDATE board
		SET    view_cnt = view_cnt+1
		WHERE  brd_num  = #{brd_num}
	</update>
	
	
	<!-- 후기 댓글 리스트 -->
	<select id="jhReviewReplyList" parameterType="Board" resultType="Board">
		SELECT * 
		FROM (
				SELECT 	 ROWNUM AS rn, a.*
				FROM	(
						SELECT	 b.brd_num, b.conts, b.reg_date, u.user_num, u.nick
						FROM 	 board b
						INNER JOIN user1 u ON b.user_num = u.user_num
						WHERE 	 b.brd_group = #{brd_num}
						AND 	 b.brd_step > 0
						ORDER BY b.brd_num DESC ) a
		) WHERE rn BETWEEN #{start} AND #{end} 
	</select>
	
	
</mapper>